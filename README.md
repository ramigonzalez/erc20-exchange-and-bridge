# Description
This is a dapp platform where allow users to swap a provided ERC20 token for ETHs. It also allow him to bridge it to Polygon network.

## Implementation
- Only the protocol owner can mint new tokens.
- There is a centralized token vault where the exchange smart contract relies on.
- An ERC20 token is provided for both Ethereum and Polygon newtworks and they differe in their implementations

## Featured technical details
- Use of inheritance of following contracts:
   - `Blacklist` for bridge contracts
   - `Validations` to share validations
   - `ERC20` to share ERC-20 token standard between `TokenEthereum` and `TokenPolygon` contracts
- Use of interfaces to expone contract methods between contracts with `IERC20Ethereum` and `IERC20Polygon` interfaces
- Use of `Check-Effect-Interact` pattern
- Unit test development for all features
- Use `Ownable` pattern
- Use of gas optimization techniques:
   - Short circuiting validations by setting less costly before
   - Data types (mostly used **uint256** in numbers except on predefined **uint8**)
   - Use of `revert` instead of `require`

## Informal sequence diagrams
### Diagrama Transfer to Polygon
![transfer-to-polygon](https://user-images.githubusercontent.com/40214297/207489307-86964094-2d8e-4c39-9151-f9f00dbdf69a.png)
### Diagrama Transfer to Ethereum
![transfet-to-ethereum](https://user-images.githubusercontent.com/40214297/207489330-0d34a15b-bca7-46ce-bae4-6f6e04fe2623.png)

## Project structure
| Path | Desctiption |
| :-- | :-- | 
| `/contracts` | Where the smart contracts are |
| `/scripts` | There is a file called `deploy.js` to deploy our smart contracts |
| `/test` | There are suits to cover all the project: exchange, bridge and tokens implementation |
| `/webapp` | The dapp implementation for metamask wallets |  

## Project setup
1. Install project dependencies running ```npm i```
2. Create an environment file called `.env` filling `.env.sample` instructions
3. Optionally, configure other networks or some other hardhart local config through `.hardhat.config.js` file

## Testing scripts
| Script | Desctiption |
| :-- | :-- |  
| `npm run test` | Runs a test suit for all contracts |
| `npm run coverage` | Give us a report of % coverage of the project |

## Protocol deploy steps
In order to simplify the deploy of the protocol, we provide scripts to do it locally or in testnet
| Script | Desctiption |
| :-- | :-- | 
| ```npm run deploy-hardhat``` | Deploy the protocol in hardhat local network |
| ```npm run deploy-hardhat``` | Deploy the protocol in ganache local network. You must have ganache intalled in your local machine |
| ```npm run deploy-goerli-mumbai``` | Deploy token, exchange and bridge contracts in **Goerli Ethereum testnet** and token and bridge contracts in **Mumbai Polygon testnet** |


# Frontend

## Frontend setup
1. Compile smart contracts by running `npx hardhat compile`
2. Deploy the protocol running `npm run deploy-goerli-mumbai`
3. Copy the contracts addresses of the deployed protocol and paste them following `web-app/.env.sample` file
4. Copy files generated by hardhat compilation in path `web-app/` project executing `cp artifacts/contracts/ web-app/src/`
5. Run the server by `yarn && yarn start` opened at [http://localhost:3000](http://localhost:3000)

## Frontend description
- There is a home screen where users connect their metamask wallet
- In the navigation tab you can go either exchange or bridge tab:
   - Exchange: you can exchange Ethers for TETH tokens
   - Bridge: you can bridge TETH tokens (Ethereum ERC20) for TPOL tokens (Polygon ERC20)
 
## Address de contratos deployados en testnet
| Contract | Address |
| :-- | :-- | 
| ERC20_Ethereum | 0x9809F7Ffa67C37ed37a4C2afa2240bdf001D0B1A |
| ERC20_Polygon | 0x0c569b4Cc5707B276F89a944E087302155b6bF0f |
| Exchange | 0xE45C3d92a31535716Ba61A35424506Bc6f70EE76 |
| Bridge_Ethereum | 0xf39add3f871E35458F9db18a43EbBC81a28F9a4f |
| Bridge_Polygon | 0xA6B1D353A9831C1AcB80B20F7f4f0E693951f17a |
